<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Elitewebcraft — Admin Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Admin dashboard styles */
    .dashboard-grid{display:grid;grid-template-columns:260px 1fr;gap:18px;align-items:start;margin-top:40px}
    .admin-side{position:sticky;top:22px;background:var(--card);padding:16px;border-radius:12px}
    .admin-main .stats-row{display:flex;gap:12px;margin-bottom:20px}
    .stat{padding:12px;text-align:center;background:var(--card);border-radius:12px}
    .users-list .user-row{display:flex;justify-content:space-between;align-items:center;padding:10px;margin-top:10px;background:var(--card);border-radius:8px}
    .small{font-size:13px}
    @media(max-width:900px){.dashboard-grid{grid-template-columns:1fr}.admin-side{position:static}}
  </style>
</head>
<body>
  <header class="nav">
    <a class="brand" href="index.html">Elitewebcraft</a>
    <nav>
      <a href="#home">Home</a>
      <a href="projects">Projects</a>
      <a href="resume.html">Resume</a>
      <a href="contact.html">Contact</a>
      <a href="logout.html">Logout</a>
    </nav>
  </header>

  <main class="container">
    <section class="dashboard-grid">
      <aside class="admin-side">
        <h3>Admin Panel</h3>
        <p class="muted">Signed in as admin</p>
        <div class="side-links">
          <button id="refreshUsers" class="btn ghost">Refresh Users</button>
          <button id="deleteAll" class="btn" style="margin-top:12px">Delete All Users</button>
        </div>
      </aside>

      <section class="admin-main">
        <h2>Overview</h2>
        <div class="stats-row">
          <div class="stat">
            <h4 id="totalUsers">0</h4>
            <p class="muted">Total users</p>
          </div>
          <div class="stat">
            <h4 id="projectsCount">3</h4>
            <p class="muted">Projects (demo)</p>
          </div>
        </div>

        <h3>Registered Users</h3>
        <div id="usersList" class="users-list"></div>
      </section>
    </section>
  </main>

  <script>
    // ----------  DATA + SIMPLE AUTH ----------
    const ADMIN_EMAIL = "elitewebdev@gmail.com";
    const ADMIN_PASS = "Admin123";

    function getUsers() {
      return JSON.parse(localStorage.getItem("ew_users") || "[]");
    }
    function saveUsers(users) {
      localStorage.setItem("ew_users", JSON.stringify(users));
    }
    function ensureAdmin() {
      const users = getUsers();
      if (!users.find(u => u.email === ADMIN_EMAIL)) {
        users.push({ fullname: "Site Admin", email: ADMIN_EMAIL, password: ADMIN_PASS });
        saveUsers(users);
      }
    }
    function getCurrentUser() {
      const email = localStorage.getItem("ew_currentUser");
      const users = getUsers();
      return users.find(u => u.email === email) || null;
    }
    function requireAdmin() {
      const user = getCurrentUser();
      if (!user || user.email !== ADMIN_EMAIL) {
        alert("Access denied! Admin only.");
        window.location.href = "login.html";
      }
    }

    // ---------- USER MANAGEMENT ----------
    function renderUsers() {
      const users = getUsers();
      const list = document.getElementById("usersList");
      list.innerHTML = "";
      document.getElementById("totalUsers").textContent = users.length;
      users.forEach(u => {
        const el = document.createElement("div");
        el.className = "user-row";
        el.innerHTML = `
          <div>
            <strong>${u.fullname || "—"}</strong>
            <div class="muted small">${u.email}</div>
          </div>
          <div>
            <button class="btn ghost" data-imp="${u.email}">Impersonate</button>
            <button class="btn" data-del="${u.email}">Delete</button>
          </div>`;
        list.appendChild(el);
      });

      // Delete user
      document.querySelectorAll("[data-del]").forEach(btn =>
        btn.onclick = e => {
          const email = e.target.getAttribute("data-del");
          if (confirm("Delete user " + email + "?")) {
            const newUsers = getUsers().filter(u => u.email !== email);
            saveUsers(newUsers);
            renderUsers();
          }
        }
      );

      // Impersonate
      document.querySelectorAll("[data-imp]").forEach(btn =>
        btn.onclick = e => {
          const email = e.target.getAttribute("data-imp");
          localStorage.setItem("ew_currentUser", email);
          alert("Now impersonating " + email);
          window.location.href = "projects.html";
        }
      );
    }

    document.getElementById("refreshUsers").onclick = renderUsers;
    document.getElementById("deleteAll").onclick = () => {
      if (confirm("Delete ALL users (except admin)?")) {
        const keepAdmin = getUsers().filter(u => u.email === ADMIN_EMAIL);
        saveUsers(keepAdmin);
        renderUsers();
      }
    };

    // ---------- INIT ----------
    ensureAdmin();
    requireAdmin();
    renderUsers();
  </script>

  <section class="project" id="project"></section>
</body>
</html>
